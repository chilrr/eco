---
interface Props {
  src: string;
  alt: string;
  title?: string;
  caption?: string;
  width?: number;
  height?: number;
  loading?: 'lazy' | 'eager';
  type?: 'normal' | 'phone';
  size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl' | 'full';
  align?: 'left' | 'center' | 'right';
  float?: 'left' | 'right' | 'none';
  border?: boolean;
  shadow?: 'none' | 'sm' | 'md' | 'lg';
  rounded?: 'none' | 'sm' | 'md' | 'lg' | 'full';
}

const { 
  src, 
  alt, 
  title, 
  caption,
  width, 
  height, 
  loading = 'lazy',
  type = 'normal',
  size = 'md',
  align = 'center',
  float = 'none',
  border = false,
  shadow = 'none',
  rounded = 'md'
} = Astro.props;
---

{type === 'phone' ? (
  <div class={`phone-mockup phone-${size} align-${align} float-${float}`}>
    <div class="phone-container">
      <img 
        src={src}
        alt={alt}
        title={title}
        width={width}
        height={height}
        loading={loading}
        class="phone-image"
      />
    </div>
    {caption && <p class="phone-caption">{caption}</p>}
  </div>
) : (
  <div class={`image-wrapper align-${align} float-${float}`}>
    <img 
      src={src}
      alt={alt}
      title={title}
      width={width}
      height={height}
      loading={loading}
      class={`optimized-image size-${size} ${border ? 'with-border' : ''} shadow-${shadow} rounded-${rounded}`}
    />
    {caption && <figcaption class="image-caption">{caption}</figcaption>}
  </div>
)}

<style>
  /* 对齐方式 */
  .align-left {
    text-align: left;
  }
  
  .align-center {
    text-align: center;
  }
  
  .align-right {
    text-align: right;
  }

  /* 浮动布局 */
  .float-left {
    float: left;
    margin: 0 1.5rem 1rem 0;
    clear: left;
  }
  
  .float-right {
    float: right;
    margin: 0 0 1rem 1.5rem;
    clear: right;
  }
  
  .float-none {
    float: none;
    margin: 1.5rem auto;
    display: block;
  }

  /* 图片包装器 */
  .image-wrapper {
    margin: 1.5rem 0;
    line-height: 0;
  }

  .image-wrapper.float-left,
  .image-wrapper.float-right {
    margin-top: 0.5rem;
  }

  /* 普通图片尺寸 */
  .optimized-image {
    height: auto;
    transition: transform 0.3s ease;
    display: inline-block;
  }

  .size-xs { max-width: 200px; }
  .size-sm { max-width: 300px; }
  .size-md { max-width: 500px; }
  .size-lg { max-width: 700px; }
  .size-xl { max-width: 900px; }
  .size-full { max-width: 100%; }

  /* 边框样式 */
  .with-border {
    border: 2px solid #e5e7eb;
  }

  /* 阴影效果 */
  .shadow-none { box-shadow: none; }
  .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
  .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
  .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }

  /* 圆角样式 */
  .rounded-none { border-radius: 0; }
  .rounded-sm { border-radius: 0.125rem; }
  .rounded-md { border-radius: 0.375rem; }
  .rounded-lg { border-radius: 0.5rem; }
  .rounded-full { border-radius: 9999px; }

  /* 悬停放大效果（无阴影） */
  .optimized-image:hover {
    transform: scale(1.05);
  }

  .float-left .optimized-image:hover,
  .float-right .optimized-image:hover {
    transform: scale(1.08);
  }

  /* 图片说明 */
  .image-caption {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-style: italic;
    line-height: 1.4;
    text-align: center;
  }

  .float-left .image-caption,
  .float-right .image-caption {
    text-align: left;
    font-size: 0.8rem;
  }

  /* 手机样式尺寸 */
  .phone-mockup {
    margin: 2rem auto;
    line-height: 0;
  }

  .phone-xs { max-width: 200px; }
  .phone-sm { max-width: 280px; }
  .phone-md { max-width: 350px; }
  .phone-lg { max-width: 420px; }
  .phone-xl { max-width: 500px; }
  .phone-full { max-width: 100%; }

  .phone-container {
    position: relative;
    display: inline-block;
    border-radius: 0;
    box-shadow: none;
    transition: transform 0.3s ease;
    background: transparent;
    padding: 0;
  }

  .phone-container:hover {
    transform: scale(1.05);
    box-shadow: none;
  }

  .phone-image {
    width: 100%;
    height: auto;
    border-radius: 0;
    display: block;
    transition: transform 0.3s ease;
  }

  .phone-container:hover .phone-image {
    filter: none;
  }

  .phone-caption {
    margin-top: 1rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-style: italic;
    line-height: 1.4;
    text-align: center;
  }

  /* 响应式设计 */
  @media (max-width: 768px) {
    .float-left,
    .float-right {
      float: none !important;
      margin: 1rem auto !important;
      text-align: center;
    }
    
    .size-xs { max-width: 180px; }
    .size-sm { max-width: 250px; }
    .size-md { max-width: 320px; }
    .size-lg { max-width: 100%; }
    .size-xl { max-width: 100%; }
    
    .phone-xs { max-width: 180px; }
    .phone-sm { max-width: 240px; }
    .phone-md { max-width: 300px; }
    .phone-lg { max-width: 350px; }
    .phone-xl { max-width: 100%; }

    .optimized-image:hover,
    .phone-container:hover {
      transform: none;
    }
  }

  @media (max-width: 480px) {
    .size-xs,
    .size-sm,
    .size-md { max-width: 100%; }
    
    .phone-xs,
    .phone-sm,
    .phone-md,
    .phone-lg { max-width: 280px; }

    /* 移动端禁用悬停效果 */
    .optimized-image:hover,
    .phone-container:hover {
      transform: none;
    }
  }

  /* 清除浮动 */
  .image-wrapper::after {
    content: "";
    display: table;
    clear: both;
  }
</style>