---
import Layout from '../../layouts/Layout.astro';
import BlogCard from '../../components/BlogCard.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const tags = [...new Set(posts.flatMap(post => post.data.tags))];
  
  return tags.map(tag => ({
    params: { tag },
    props: { 
      posts: posts.filter(post => post.data.tags.includes(tag)),
      tag 
    },
  }));
}

const { posts, tag } = Astro.props;

// SEO优化数据
const tagDescription = `探索所有关于"${tag}"的文章内容，包含${posts.length}篇相关文章`;
const relatedTags = [...new Set(posts.flatMap(post => post.data.tags))].filter(t => t !== tag);
---

<Layout title={`${tag}相关文章 - 加密说明书 (${posts.length}篇)`}>
	<div class="seo-meta">
		<meta name="description" content={tagDescription} />
		<meta name="keywords" content={`${tag}, ${relatedTags.slice(0, 5).join(', ')}, 加密货币, 区块链`} />
		<meta property="og:title" content={`${tag}相关文章 - 加密说明书`} />
		<meta property="og:description" content={tagDescription} />
	</div>
	
	<main>
		<div class="tag-header">
			<h1>#{tag}</h1>
			<p class="tag-description">{tagDescription}</p>
			<div class="tag-stats">
				<span class="article-count">{posts.length} 篇文章</span>
				<span class="last-updated">最近更新: {new Date(Math.max(...posts.map(p => p.data.pubDate.getTime()))).toLocaleDateString('zh-CN')}</span>
			</div>
		</div>
		
		{relatedTags.length > 0 && (
			<div class="related-tags">
				<h3>相关标签</h3>
				<div class="tags-list">
					{relatedTags.slice(0, 8).map(relatedTag => (
						<a href={`/tags/${relatedTag}`} class="related-tag">#{relatedTag}</a>
					))}
				</div>
			</div>
		)}
		
		<div class="blog-grid">
			{posts.map(post => (
				<a href={`/${post.slug}`} class="card-link">
					<BlogCard
						title={post.data.title}
						description={post.data.description}
						image={post.data.image}
					/>
				</a>
			))}
		</div>
		
		<div class="tag-footer">
			<p>浏览更多 <a href="/tags">所有标签</a> 或返回 <a href="/">首页</a></p>
		</div>
	</main>
</Layout>

<style>
	main {
		padding: 2rem;
		max-width: 1400px;
		margin: 0 auto;
	}
	
	.tag-header {
		margin-bottom: 2rem;
		text-align: center;
		padding: 2rem 0;
		border-bottom: 1px solid #e0e0e0;
	}
	
	.tag-header h1 {
		font-size: 2.5rem;
		margin-bottom: 1rem;
		color: var(--text-primary);
		font-weight: 700;
	}
	
	.tag-description {
		font-size: 1.1rem;
		color: var(--text-secondary);
		margin-bottom: 1rem;
		max-width: 600px;
		margin-left: auto;
		margin-right: auto;
	}
	
	.tag-stats {
		display: flex;
		justify-content: center;
		gap: 2rem;
		font-size: 0.9rem;
		color: var(--text-secondary);
	}
	
	.related-tags {
		margin-bottom: 2rem;
		padding: 1.5rem;
		background: rgba(0, 0, 0, 0.02);
		border-radius: 8px;
	}
	
	.related-tags h3 {
		margin-bottom: 1rem;
		color: var(--text-primary);
	}
	
	.tags-list {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
	}
	
	.related-tag {
		padding: 0.5rem 1rem;
		background: white;
		border: 1px solid #ddd;
		border-radius: 20px;
		text-decoration: none;
		color: var(--text-secondary);
		font-size: 0.9rem;
		transition: all 0.2s ease;
	}
	
	.related-tag:hover {
		background: var(--text-primary);
		color: white;
		border-color: var(--text-primary);
	}
	
	.blog-grid {
		display: grid;
		grid-template-columns: repeat(4, 1fr);
		gap: 2rem;
		margin-bottom: 3rem;
	}
	
	.card-link {
		text-decoration: none;
	}
	
	.tag-footer {
		text-align: center;
		padding: 2rem 0;
		border-top: 1px solid #e0e0e0;
		color: var(--text-secondary);
	}
	
	.tag-footer a {
		color: var(--text-primary);
		text-decoration: none;
		font-weight: 500;
	}
	
	.tag-footer a:hover {
		text-decoration: underline;
	}
	
	@media (max-width: 1200px) {
		.blog-grid {
			grid-template-columns: repeat(3, 1fr);
		}
		.tag-stats {
			flex-direction: column;
			gap: 0.5rem;
		}
	}
	@media (max-width: 900px) {
		.blog-grid {
			grid-template-columns: repeat(2, 1fr);
		}
		.tag-header h1 {
			font-size: 2rem;
		}
	}
	@media (max-width: 600px) {
		.blog-grid {
			grid-template-columns: 1fr;
		}
		.tags-list {
			justify-content: center;
		}
	}
</style>